Name:           orions-gate
Version:        1.0.alpha.1
Release:        1%{?dist}
Summary:        Orion's Gate — desktop application
Summary(ru_RU.UTF-8): Orion's Gate — настольное приложение
License:        MIT
Group:          Graphical desktop/Other
Url:            https://github.com/Cheviiot/Orions-Gate

# Source0 should be a tarball prepared for RPM:
# - must contain a directory "linux-unpacked/" with the ready-to-run Electron bundle (or equivalent)
# - optionally "icon.png" (512x512 or 1024x1024)
Source0:        %{name}-%{version}.tar.gz

ExclusiveArch:  x86_64

# NOTE:
# For Electron bundles, RPM usually auto-detects shared library dependencies from the binaries.
# Add manual Requires: only if you intentionally exclude binaries from dependency scanning.

%description
Orion's Gate is a desktop application packaged for ALT Linux.

%description -l ru_RU.UTF-8
Orion's Gate — настольное приложение, упакованное для ALT Linux.

%prep
%setup -q

%install
rm -rf %{buildroot}

# 1) Install application files (prepared bundle)
install -d %{buildroot}%{_datadir}/%{name}
cp -a linux-unpacked/* %{buildroot}%{_datadir}/%{name}/

# 2) Electron sandbox (if present) must be setuid root
# (this is common practice in ALT packages for Electron apps)
if [ -e %{buildroot}%{_datadir}/%{name}/chrome-sandbox ]; then
    chmod 4755 %{buildroot}%{_datadir}/%{name}/chrome-sandbox
fi

# 3) Ensure we have a stable executable name: %{name}
# If your bundle already contains "orions-gate" executable — it will be used.
# Otherwise we try to link the first executable file from bundle root to "%{name}".
if [ -x %{buildroot}%{_datadir}/%{name}/%{name} ]; then
    :
elif [ -x %{buildroot}%{_datadir}/%{name}/orions-gate ]; then
    ln -sf orions-gate %{buildroot}%{_datadir}/%{name}/%{name}
else
    bin="$(find %{buildroot}%{_datadir}/%{name} -maxdepth 1 -type f -perm -0100 | head -n 1)"
    if [ -n "$bin" ]; then
        ln -sf "$(basename "$bin")" %{buildroot}%{_datadir}/%{name}/%{name}
    fi
fi

# 4) Wrapper in PATH
install -d %{buildroot}%{_bindir}
cat > %{buildroot}%{_bindir}/%{name} <<EOF
#!/bin/sh
exec %{_datadir}/%{name}/%{name} "\$@"
EOF
chmod 0755 %{buildroot}%{_bindir}/%{name}

# 5) Desktop entry
install -d %{buildroot}%{_desktopdir}
cat > %{buildroot}%{_desktopdir}/%{name}.desktop <<EOF
[Desktop Entry]
Type=Application
Name=Orion's Gate
Name[ru]=Orion's Gate
Comment=Orion's Gate desktop application
Comment[ru]=Настольное приложение Orion's Gate
Exec=%{_bindir}/%{name} %U
Icon=%{name}
Terminal=false
Categories=Utility;
StartupNotify=true
EOF

# 6) Icon (prefer hicolor theme path)
# Put your PNG as icon.png in the Source0 root.
if [ -f icon.png ]; then
    install -d %{buildroot}%{_iconsdir}/hicolor/512x512/apps
    install -m0644 icon.png %{buildroot}%{_iconsdir}/hicolor/512x512/apps/%{name}.png
fi

%files
%license LICENSE* COPYING*
%doc README* CHANGELOG*
%{_bindir}/%{name}
%{_desktopdir}/%{name}.desktop
%{_datadir}/%{name}/
%{_iconsdir}/hicolor/*/apps/%{name}.png

%changelog
* Thu Jan 22 2026 Cheviiot (Александр) - 1.0.alpha.1-1
- Initial package
